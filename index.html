<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Winter AR</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

    <script>
      // Keeps the shadow plane under the currently selected object group
      AFRAME.registerComponent("follow-shadow", {
        schema: { type: "selector" },
        init() {
          this.el.object3D.renderOrder = -1;
        },
        tick() {
          if (this.data) {
            this.el.object3D.position.copy(this.data.object3D.position);
            this.el.object3D.position.y -= 0.001; // avoids flickering (z-fighting)
          }
        },
      });

      // Tap anywhere to place the objects group on the ground hit position
      AFRAME.registerComponent("tap-to-place", {
        schema: { target: { type: "selector" } }, // the entity we move when tapping
        init() {
          // Listen for taps/clicks on the scene
          this.el.sceneEl.addEventListener("click", (evt) => {
            // Hit-test intersection point from the AR ground plane
            const hit = evt.detail && evt.detail.intersection;
            if (!hit) return;

            // Move the target object group to the tapped position
            this.data.target.object3D.position.copy(hit.point);
          });
        },
      });

      // Switch between snowman and tree by changing which group is visible
      AFRAME.registerComponent("switch-object", {
        init() {
          const snowman = document.querySelector("#snowman");
          const tree = document.querySelector("#tree");

          // Start with snowman visible
          tree.setAttribute("visible", "false");

          document.querySelector("#btnSnowman").addEventListener("click", () => {
            snowman.setAttribute("visible", "true");
            tree.setAttribute("visible", "false");
          });

          document.querySelector("#btnTree").addEventListener("click", () => {
            snowman.setAttribute("visible", "false");
            tree.setAttribute("visible", "true");
          });
        },
      });
    </script>

    <style>
      /* Simple overlay UI */
      #ui {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 9999;
        display: flex;
        gap: 8px;
      }
      button {
        font-size: 14px;
        padding: 8px 10px;
      }
    </style>
  </head>

  <body>
    <!-- Simple buttons to choose what to place -->
    <div id="ui">
      <button id="btnSnowman">Snowman</button>
      <button id="btnTree">Pine tree</button>
    </div>

    <a-scene
      reflection="directionalLight: a-light[type=directional]"
      ar-hit-test="target: #objects;"
      renderer="colorManagement: true; exposure: 1; toneMapping: ACESFilmic"
      shadow="type: pcfsoft"
      xr-mode-ui="XRMode: xr"
      tap-to-place="target: #objects"
      switch-object
    >
      <!-- Light that can cast shadows -->
      <a-light
        type="directional"
        light="castShadow:true;"
        position="1 1 1"
        intensity="1.2"
        shadow-camera-automatic="#objects"
      ></a-light>

      <!-- Camera (WebXR AR uses your device camera when you press AR) -->
      <a-camera position="0 0.4 0"></a-camera>

      <!-- This is the GROUP we move around when tapping -->
      <a-entity id="objects" scale="0.2 0.2 0.2" position="0 0 -1" shadow>
        <!-- SNOWMAN -->
        <a-entity id="snowman" position="0 0 0">
          <a-sphere radius="0.6" color="#ffffff" position="0 0.6 0"></a-sphere>
          <a-sphere radius="0.45" color="#ffffff" position="0 1.35 0"></a-sphere>
          <a-sphere radius="0.3" color="#ffffff" position="0 1.9 0"></a-sphere>

          <!-- Nose -->
          <a-cone
            color="#ff8c00"
            radius-bottom="0.06"
            radius-top="0.001"
            height="0.18"
            position="0 1.9 0.32"
            rotation="90 0 0"
          ></a-cone>
        </a-entity>

        <!-- PINE TREE -->
        <a-entity id="tree" position="0 0 0">
          <!-- Trunk -->
          <a-cylinder radius="0.12" height="0.6" color="#8b5a2b" position="0 0.3 0"></a-cylinder>
          <!-- Leaves -->
          <a-cone radius-bottom="0.7" radius-top="0.001" height="1.0" color="#1e7a34" position="0 1.1 0"></a-cone>
          <a-cone radius-bottom="0.5" radius-top="0.001" height="0.8" color="#1b6b2e" position="0 1.55 0"></a-cone>
        </a-entity>
      </a-entity>

      <!-- Shadow receiver plane that follows the objects group -->
      <a-plane
        follow-shadow="#objects"
        material="shader:shadow"
        shadow="cast:false;"
        rotation="-90 0 0"
        width="2"
        height="2"
      ></a-plane>

      <!-- Sky only visible outside AR mode -->
      <a-sky color="#ECECEC" hide-on-enter-ar></a-sky>
    </a-scene>
  </body>
</html>
